<!doctype html>
<html lang="gu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Auto Daily Stock + Cold Drink Stock</title>

  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Noto+Sans+Gujarati:wght@400;700&display=swap" rel="stylesheet"/>

  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: "Noto Sans Gujarati", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #e3f2fd 0, #f5f7ff 40%, #e8f5e9 100%);
      min-height: 100vh;
      padding: 18px 10px 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #111827;
    }

    .card {
      width: 100%;
      max-width: 520px;
      background: #ffffff;
      border-radius: 24px;
      padding: 18px 14px 20px;
      box-shadow: 0 18px 38px rgba(15, 23, 42, 0.16);
      margin-bottom: 22px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 14px;
    }
    .card-header span.emoji {
      font-size: 26px;
    }
    .card-header h1,
    .card-header h2 {
      margin: 0;
      font-family: "Baloo 2", system-ui;
      font-size: 20px;
      letter-spacing: 0.02em;
    }

    .sub-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    label {
      font-size: 13px;
      font-weight: 600;
      color: #4b5563;
    }

    input[type="date"],
    input[type="text"],
    input[type="number"],
    .search-input {
      width: 100%;
      padding: 9px 11px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, transform 0.05s;
      background: #f9fafb;
    }
    input:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.17);
      background: #ffffff;
      transform: translateY(-0.5px);
    }

    .search-wrapper {
      position: relative;
      flex: 1;
    }
    .search-wrapper .search-input {
      padding-left: 28px;
    }
    .search-wrapper::before {
      content: "ğŸ”";
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
      opacity: 0.7;
    }

    .date-wrapper {
      flex: 1;
      min-width: 140px;
    }

    .mini-label {
      font-size: 11px;
      margin-bottom: 3px;
      color: #6b7280;
      font-weight: 600;
    }

    .totals-row {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    .total-pill {
      flex: 1;
      min-width: 150px;
      border-radius: 16px;
      padding: 9px 10px;
      background: linear-gradient(120deg, #eef2ff, #e0f2fe);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 16px rgba(148, 163, 184, 0.35);
    }
    .total-pill.green {
      background: linear-gradient(120deg, #dcfce7, #bbf7d0);
    }
    .total-label {
      font-size: 11px;
      text-transform: uppercase;
      color: #4b5563;
      letter-spacing: 0.06em;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .total-value {
      font-size: 20px;
      font-weight: 800;
      color: #111827;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 16px;
      overflow: hidden;
      background: #f9fafb;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
      margin-bottom: 12px;
    }
    thead {
      background: linear-gradient(90deg, #1d4ed8, #22c55e);
      color: #ffffff;
    }
    th, td {
      padding: 7px 6px;
      font-size: 12px;
      text-align: center;
      border-bottom: 1px solid #e5e7eb;
    }
    th:nth-child(2) {
      min-width: 120px;
    }
    tbody tr:nth-child(even) {
      background-color: #f3f4f6;
    }
    tbody tr:last-child td {
      border-bottom: none;
    }
    td input {
      width: 100%;
    }

    /* ğŸ”’ Milk item label (not editable) */
    .milk-item {
      width: 100%;
      padding: 7px 8px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #eef2ff;
      font-size: 13px;
      text-align: center;
      user-select: none;
    }

    .btn-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .btn {
      border: none;
      outline: none;
      padding: 8px 18px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 9px 18px rgba(15, 23, 42, 0.22);
      transition: transform 0.07s, box-shadow 0.07s, opacity 0.1s;
      color: #ffffff;
      background: linear-gradient(135deg, #fb923c, #f97316);
    }
    .btn.blue {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
    }
    .btn.green {
      background: linear-gradient(135deg, #22c55e, #16a34a);
    }
    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.18);
      opacity: 0.9;
    }

    .section-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      background: #22c55e;
      color: #ffffff;
      box-shadow: 0 6px 12px rgba(34, 197, 94, 0.4);
    }

    /* Cold drink layout */

    .cold-group-title {
      font-size: 13px;
      font-weight: 800;
      margin: 10px 0 4px;
      color: #0f172a;
    }
    .cold-group-title span.sub {
      font-weight: 600;
      font-size: 11px;
      color: #6b7280;
      margin-left: 4px;
    }
    .cold-row {
      display: grid;
      grid-template-columns: 1.6fr 0.6fr 0.8fr;
      align-items: center;
      gap: 4px;
      padding: 4px 0;
      border-bottom: 1px dashed #e5e7eb;
      font-size: 12px;
    }
    .cold-row:last-child {
      border-bottom: none;
    }
    .cold-brand {
      text-align: left;
      padding-left: 2px;
    }
    .cold-ml {
      text-align: center;
      font-weight: 600;
      color: #4b5563;
    }
    .cold-qty {
      width: 100%;
      text-align: center;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      font-size: 12px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .cold-qty:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.17);
      background: #ffffff;
    }

    .cold-footer-totals {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .cold-footer-totals .total-pill {
      flex: 1;
      min-width: 150px;
    }

    .no-data {
      margin-top: 6px;
      font-size: 11px;
      color: #b91c1c;
      text-align: center;
    }

    .hint {
      font-size: 10px;
      color: #6b7280;
      text-align: center;
      margin-top: 6px;
    }

    @media (min-width: 600px) {
      body {
        padding-top: 28px;
      }
      .card {
        padding: 20px 18px 22px;
      }
    }
  </style>
</head>
<body>

  <!-- ========== TOP: AUTO DAILY STOCK SHEET (MILK) ========== -->
  <section class="card" id="milkCard">
    <div class="card-header">
      <span class="emoji">ğŸ“¦</span>
      <h1>Auto Daily Stock Sheet</h1>
    </div>

    <div class="sub-row">
      <div class="date-wrapper">
        <div class="mini-label">àª¤àª¾àª°à«€àª–</div>
        <input type="date" id="milkDate">
      </div>
      <div class="search-wrapper">
        <div class="mini-label">àªµàª¸à«àª¤à« àª¶à«‹àª§à«‹...</div>
        <input type="text" id="milkSearch" class="search-input" placeholder="àªœà«‡àª® àª•à«‡: àª¦à«‚àª§, àª›àª¾àª¶...">
      </div>
    </div>

    <div class="totals-row">
      <div class="total-pill">
        <div class="total-label">àª•à«àª² Stock</div>
        <div class="total-value" id="milkTotalStock">0</div>
      </div>
      <div class="total-pill green">
        <div class="total-label">àª•à«àª² Auto</div>
        <div class="total-value" id="milkTotalAuto">0</div>
      </div>
    </div>

    <table id="milkTable">
      <thead>
        <tr>
          <th>Stock</th>
          <th>Item</th>
          <th>Auto</th>
        </tr>
      </thead>
      <tbody>
        <!-- Item column àª¹àªµà«‡ lock àª›à«‡ -->
        <tr>
          <td><input type="number" class="milk-stock" min="0" step="0.01"></td>
          <td><div class="milk-item">àª²à«€àªŸàª°</div></td>
          <td><input type="number" class="milk-auto" min="0" step="0.01"></td>
        </tr>
        <tr>
          <td><input type="number" class="milk-stock" min="0" step="0.01"></td>
          <td><div class="milk-item">àª¤àª¾àªœàª¾</div></td>
          <td><input type="number" class="milk-auto" min="0" step="0.01"></td>
        </tr>
        <tr>
          <td><input type="number" class="milk-stock" min="0" step="0.01"></td>
          <td><div class="milk-item">àª›àª¾àª¶</div></td>
          <td><input type="number" class="milk-auto" min="0" step="0.01"></td>
        </tr>
        <tr>
          <td><input type="number" class="milk-stock" min="0" step="0.01"></td>
          <td><div class="milk-item">àª àª¬à«àª¡àª¾</div></td>
          <td><input type="number" class="milk-auto" min="0" step="0.01"></td>
        </tr>
        <tr>
          <td><input type="number" class="milk-stock" min="0" step="0.01"></td>
          <td><div class="milk-item">àª¦àª¹à«€àª‚</div></td>
          <td><input type="number" class="milk-auto" min="0" step="0.01"></td>
        </tr>
        <tr>
          <td><input type="number" class="milk-stock" min="0" step="0.01"></td>
          <td><div class="milk-item">àª–àª¾àªŸà«€ àª›àª¾àª¶</div></td>
          <td><input type="number" class="milk-auto" min="0" step="0.01"></td>
        </tr>
        <tr>
          <td><input type="number" class="milk-stock" min="0" step="0.01"></td>
          <td><div class="milk-item">àª®àª¾àª–àª£</div></td>
          <td><input type="number" class="milk-auto" min="0" step="0.01"></td>
        </tr>
      </tbody>
    </table>

    <div class="btn-row">
      <button class="btn" id="btnSaveTop">ğŸ’¾ Save</button>
      <button class="btn blue" id="btnLoadTop">ğŸ“‚ Load</button>
      <button class="btn green" id="btnWATop">ğŸŸ¢ WhatsApp</button>
    </div>

    <div class="hint">Note: àª‰àªªàª° Save / Load àª¬àª‚àª¨à«‡ àª¸à«‡àª•àª¶àª¨ (Milk + Cold Drink) àªàª•àª¸àª¾àª¥à«‡ Save àª¥àª¶à«‡.</div>
  </section>

  <!-- ========== BOTTOM: COLD DRINK STOCK ========== -->
  <section class="card" id="coldCard">
    <div class="section-title-row">
      <div class="card-header" style="margin-bottom:0;padding:0;gap:8px;justify-content:flex-start;">
        <span class="emoji">ğŸ¥¤</span>
        <h2>Cold Drink Stock</h2>
      </div>
      <div class="badge">Daily Sheet</div>
    </div>

    <div class="sub-row">
      <div class="date-wrapper">
        <div class="mini-label">Date</div>
        <input type="date" id="coldDate">
      </div>
    </div>

    <!-- Cold drink rows (unchanged) -->
    <!-- 250 ml Small -->
    <div class="cold-group">
      <div class="cold-group-title">250 ml <span class="sub">Small</span></div>
      <div class="cold-row" data-ml="250" data-group="250-small">
        <div class="cold-brand">Thumpup</div>
        <div class="cold-ml">250</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="250" data-group="250-small">
        <div class="cold-brand">Sprite</div>
        <div class="cold-ml">250</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="250" data-group="250-small">
        <div class="cold-brand">Maza</div>
        <div class="cold-ml">250</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="250" data-group="250-small">
        <div class="cold-brand">Fanta</div>
        <div class="cold-ml">250</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="250" data-group="250-small">
        <div class="cold-brand">Cocacola</div>
        <div class="cold-ml">250</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="250" data-group="250-small">
        <div class="cold-brand">Palpy orange</div>
        <div class="cold-ml">250</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="250" data-group="250-small">
        <div class="cold-brand">Charge</div>
        <div class="cold-ml">250</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="250" data-group="250-small">
        <div class="cold-brand">Soda</div>
        <div class="cold-ml">250</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="250" data-group="250-small">
        <div class="cold-brand">Maaza</div>
        <div class="cold-ml">140</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
    </div>

    <!-- 750 ml Medium -->
    <div class="cold-group">
      <div class="cold-group-title">750 ml <span class="sub">Medium</span></div>
      <div class="cold-row" data-ml="750" data-group="750-medium">
        <div class="cold-brand">Thumpup</div>
        <div class="cold-ml">750</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="750" data-group="750-medium">
        <div class="cold-brand">Sprite</div>
        <div class="cold-ml">750</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="750" data-group="750-medium">
        <div class="cold-brand">Fanta</div>
        <div class="cold-ml">750</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="750" data-group="750-medium">
        <div class="cold-brand">Soda</div>
        <div class="cold-ml">750</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
    </div>

    <!-- 1 Liter Family -->
    <div class="cold-group">
      <div class="cold-group-title">1 Liter <span class="sub">Family</span></div>
      <div class="cold-row" data-ml="1000" data-group="1l-family">
        <div class="cold-brand">Thumpup</div>
        <div class="cold-ml">1L</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="1000" data-group="1l-family">
        <div class="cold-brand">Sprite</div>
        <div class="cold-ml">1L</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="1000" data-group="1l-family">
        <div class="cold-brand">Fanta</div>
        <div class="cold-ml">1L</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="1000" data-group="1l-family">
        <div class="cold-brand">Maza</div>
        <div class="cold-ml">1L</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
    </div>

    <!-- 2.25 Liter Party -->
    <div class="cold-group">
      <div class="cold-group-title">2.25 Liter <span class="sub">Party</span></div>
      <div class="cold-row" data-ml="2250" data-group="2_25-party">
        <div class="cold-brand">Thumpup</div>
        <div class="cold-ml">2.25L</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="2250" data-group="2_25-party">
        <div class="cold-brand">Sprite</div>
        <div class="cold-ml">2.25L</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
      <div class="cold-row" data-ml="2250" data-group="2_25-party">
        <div class="cold-brand">Fanta</div>
        <div class="cold-ml">2.25L</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
    </div>

    <!-- Water -->
    <div class="cold-group">
      <div class="cold-group-title">Water & Summary</div>
      <div class="cold-row" data-ml="1000" data-group="water">
        <div class="cold-brand">Whoter 1 Liter</div>
        <div class="cold-ml">1L</div>
        <input class="cold-qty" type="number" min="0" step="1">
      </div>
    </div>

    <div class="cold-footer-totals">
      <div class="total-pill">
        <div class="total-label">Total Bottle</div>
        <div class="total-value" id="coldTotalBottle">0</div>
      </div>
      <div class="total-pill green">
        <div class="total-label">Total Liter</div>
        <div class="total-value" id="coldTotalLiter">0.00</div>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn" id="btnSaveBottom">ğŸ’¾ Save</button>
      <button class="btn blue" id="btnLoadBottom">ğŸ“‚ Load</button>
      <button class="btn green" id="btnWABottom">ğŸŸ¢ WhatsApp</button>
    </div>

    <div class="no-data" id="noDataMsg">No data found for this date.</div>
  </section>

  <script>
    // ğŸ”— Firebase base URL
    const FIREBASE_BASE =
      "https://booking-e751e-default-rtdb.firebaseio.com/dailyStock";

    // ====== Utility: today date set ======
    function setToday(id) {
      const el = document.getElementById(id);
      if (!el.value) {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, "0");
        const dd = String(today.getDate()).padStart(2, "0");
        el.value = `${yyyy}-${mm}-${dd}`;
      }
    }
    setToday("milkDate");
    setToday("coldDate");

    // BOTH dates same àª°àª¾àª–àªµà«€
    const milkDateEl = document.getElementById("milkDate");
    const coldDateEl = document.getElementById("coldDate");
    milkDateEl.addEventListener("change", () => (coldDateEl.value = milkDateEl.value));
    coldDateEl.addEventListener("change", () => (milkDateEl.value = coldDateEl.value));

    // ====== MILK: totals & search ======
    function recalcMilkTotals() {
      let totalStock = 0;
      let totalAuto = 0;
      document.querySelectorAll("#milkTable tbody tr").forEach((row) => {
        const stock = parseFloat(row.querySelector(".milk-stock").value) || 0;
        const auto = parseFloat(row.querySelector(".milk-auto").value) || 0;
        totalStock += stock;
        totalAuto += auto;
      });
      document.getElementById("milkTotalStock").textContent = totalStock.toFixed(2);
      document.getElementById("milkTotalAuto").textContent = totalAuto.toFixed(2);
    }
    document.querySelectorAll(".milk-stock, .milk-auto").forEach((inp) => {
      inp.addEventListener("input", recalcMilkTotals);
    });
    recalcMilkTotals();

    document.getElementById("milkSearch").addEventListener("input", (e) => {
      const term = e.target.value.toLowerCase().trim();
      document.querySelectorAll("#milkTable tbody tr").forEach((row) => {
        const itemVal =
          row.querySelector(".milk-item").textContent.toLowerCase() || "";
        row.style.display = term && !itemVal.includes(term) ? "none" : "";
      });
    });

    // ====== COLD: totals ======
    function recalcColdTotals() {
      let totalBottle = 0;
      let totalLiter = 0;
      document.querySelectorAll(".cold-row").forEach((row) => {
        const ml = parseFloat(row.dataset.ml) || 0;
        const qty = parseFloat(row.querySelector(".cold-qty").value) || 0;
        totalBottle += qty;
        totalLiter += (qty * ml) / 1000;
      });
      document.getElementById("coldTotalBottle").textContent =
        totalBottle.toFixed(0);
      document.getElementById("coldTotalLiter").textContent =
        totalLiter.toFixed(2);
    }
    document.querySelectorAll(".cold-qty").forEach((inp) => {
      inp.addEventListener("input", recalcColdTotals);
    });
    recalcColdTotals();

    // ====== COLLECT & FILL DATA ======
    function collectPageData() {
      const milkRows = Array.from(
        document.querySelectorAll("#milkTable tbody tr")
      ).map((row) => ({
        stock: row.querySelector(".milk-stock").value || "",
        item: row.querySelector(".milk-item").textContent.trim() || "",
        auto: row.querySelector(".milk-auto").value || "",
      }));

      const coldRows = Array.from(document.querySelectorAll(".cold-row")).map(
        (row) => ({
          group: row.dataset.group,
          brand: row.querySelector(".cold-brand").textContent.trim(),
          ml: parseFloat(row.dataset.ml) || 0,
          qty: row.querySelector(".cold-qty").value || "",
        })
      );

      return {
        milk: {
          date: milkDateEl.value,
          rows: milkRows,
          totalStock: document.getElementById("milkTotalStock").textContent,
          totalAuto: document.getElementById("milkTotalAuto").textContent,
        },
        cold: {
          date: coldDateEl.value,
          rows: coldRows,
          totalBottle: document.getElementById("coldTotalBottle").textContent,
          totalLiter: document.getElementById("coldTotalLiter").textContent,
        },
      };
    }

    function fillPageFromData(data) {
      if (data.milk && data.milk.rows) {
        const rows = document.querySelectorAll("#milkTable tbody tr");
        rows.forEach((row, idx) => {
          const d = data.milk.rows[idx] || {};
          row.querySelector(".milk-stock").value = d.stock || "";
          row.querySelector(".milk-auto").value = d.auto || "";
          // item label fix àª›à«‡, àª¬àª¦àª²àª¤àª¾ àª¨àª¥à«€
        });
      }
      if (data.cold && data.cold.rows) {
        const coldRows = document.querySelectorAll(".cold-row");
        coldRows.forEach((row, idx) => {
          const d = data.cold.rows[idx] || {};
          row.querySelector(".cold-qty").value = d.qty || "";
        });
      }
      recalcMilkTotals();
      recalcColdTotals();
    }

    // ====== Firebase SAVE / LOAD ======
    async function saveToFirebase() {
      const dateKey = milkDateEl.value;
      if (!dateKey) {
        alert("àªªàª¹à«‡àª²àª¾àª‚ àª¤àª¾àª°à«€àª– àªªàª¸àª‚àª¦ àª•àª°à«‹.");
        return;
      }
      const payload = collectPageData();
      try {
        const url = `${FIREBASE_BASE}/${dateKey}.json`;
        const res = await fetch(url, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        if (!res.ok) throw new Error("Firebase error");
        document.getElementById("noDataMsg").textContent = "Saved âœ…";
        setTimeout(() => {
          document.getElementById("noDataMsg").textContent =
            "No data found for this date.";
        }, 2000);
      } catch (err) {
        console.error(err);
        alert("Save error âŒ\nInternet / Firebase URL àª¤àªªàª¾àª¸à«‹.");
      }
    }

    async function loadFromFirebase() {
      const dateKey = milkDateEl.value;
      if (!dateKey) {
        alert("àªªàª¹à«‡àª²àª¾àª‚ àª¤àª¾àª°à«€àª– àªªàª¸àª‚àª¦ àª•àª°à«‹.");
        return;
      }
      try {
        const url = `${FIREBASE_BASE}/${dateKey}.json`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Firebase error");
        const data = await res.json();
        if (!data) {
          document.getElementById("noDataMsg").textContent =
            "No data found for this date.";
          fillPageFromData({ milk: { rows: [] }, cold: { rows: [] } });
          return;
        }
        fillPageFromData(data);
        document.getElementById("noDataMsg").textContent =
          "Data loaded âœ…";
        setTimeout(() => {
          document.getElementById("noDataMsg").textContent =
            "No data found for this date.";
        }, 2000);
      } catch (err) {
        console.error(err);
        alert("Load error âŒ");
      }
    }

    // ====== WhatsApp ======
    function buildWhatsAppMessage() {
      const date = milkDateEl.value || "";
      const data = collectPageData();
      const lines = [];

      lines.push(`ğŸ“¦ Auto Daily Stock Sheet (${date})`);
      data.milk.rows.forEach((r) => {
        if ((r.stock || r.auto) && r.item) {
          lines.push(
            `${r.item}  Stock: ${r.stock || 0}  Auto: ${r.auto || 0}`
          );
        }
      });
      lines.push("");
      lines.push(
        `àª•à«àª² Stock: ${data.milk.totalStock}  |  àª•à«àª² Auto: ${data.milk.totalAuto}`
      );
      lines.push("");
      lines.push(`ğŸ¥¤ Cold Drink Stock (${date})`);
      data.cold.rows.forEach((r) => {
        if (r.qty) {
          lines.push(
            `${r.brand} ${r.ml}ml  Qty: ${r.qty}`
          );
        }
      });
      lines.push("");
      lines.push(
        `Total Bottle: ${data.cold.totalBottle}  |  Total Liter: ${data.cold.totalLiter}`
      );

      return encodeURIComponent(lines.join("\n"));
    }

    function openWhatsApp() {
      const msg = buildWhatsAppMessage();
      const url = `https://wa.me/?text=${msg}`;
      window.open(url, "_blank");
    }

    // ====== Button wiring ======
    document.getElementById("btnSaveTop").addEventListener("click", saveToFirebase);
    document.getElementById("btnSaveBottom").addEventListener("click", saveToFirebase);
    document.getElementById("btnLoadTop").addEventListener("click", loadFromFirebase);
    document.getElementById("btnLoadBottom").addEventListener("click", loadFromFirebase);
    document.getElementById("btnWATop").addEventListener("click", openWhatsApp);
    document.getElementById("btnWABottom").addEventListener("click", openWhatsApp);
  </script>
</body>
        </html>
